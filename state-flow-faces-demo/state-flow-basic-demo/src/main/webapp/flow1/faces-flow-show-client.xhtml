<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<f:metadata
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://xmlns.ssoft.org/flow/scxml"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    >
    <x:scxml id="main" initial="start">

        <x:datamodel>
            <x:data id="chart_title" expr="Show Client State Flow Process"/>
            <x:data id="chart_view" expr="/flow1/faces-flow-show-client.xhtml"/>
        </x:datamodel>


        <x:state id="start">
            <x:onentry>
                <x:if cond="#{main.prepare()}">
                    <x:raise event="main.prepare.success"/>
                    <x:else/>
                    <x:raise event="main.prepare.failed"/>
                </x:if>
            </x:onentry>
            <x:transition event="main.prepare.success" target="show"/>
            <x:transition event="main.prepare.failed" target="exit"/>
        </x:state>

        <x:parallel id="show">
            <x:onentry>
                <x:log expr="I'm starting parallel"/>
            </x:onentry>
            <x:onexit>
                <x:log expr="I'm finishing parallel"/>
            </x:onexit>

            <x:state id="show-client">
                <x:onentry>
                    <x:log expr="I'm starting show-client"/>
                </x:onentry>
                <x:onexit>
                    <x:log expr="I'm finishing show-client"/>
                </x:onexit>
                
                <x:invoke type="view" src="ShowClientPage.xhtml"/>
                <x:transition event="show-client.invoke.failed" target="error"/>

                <x:transition event="show-client.view.action.accept" target="success"/>
                <x:transition event="show-client.view.action.cancel" target="cancel"/>
            </x:state>

            <x:state id="show-process">
                <x:onentry>
                    <x:log expr="I'm starting show-process"/>
                </x:onentry>
                <x:onexit>
                    <x:log expr="I'm finishing show-process"/>
                </x:onexit>

                <x:initial>
                    <x:transition target="show-process-1"/>
                </x:initial>

                <x:state id="show-process-1">
                    <x:onentry>
                        <x:log expr="I'm starting show-process-1"/>
                    </x:onentry>
                    <x:onexit>
                        <x:log expr="I'm finishing show-process-1"/>
                    </x:onexit>

                    <x:transition event="show-client.invoke.action.next_process" target="show-process-2"/>
                </x:state>     

                <x:state id="show-process-2">
                    <x:onentry>
                        <x:log expr="I'm starting show-process-2"/>
                    </x:onentry>
                    <x:onexit>
                        <x:log expr="I'm finishing show-process-2"/>
                    </x:onexit>

                    <x:transition event="show-client.invoke.action.next" target="show-process-1"/>
                </x:state>             
            </x:state> 
        </x:parallel>

        <x:state id="error"> 
            <x:invoke type="scxml" src="/common/error.scxml">
                <x:finalize/>
            </x:invoke>
            <x:transition event="error.invoke.cancel" target="exit"/>
            <x:transition event="error.invoke.failed" target="exit"/>
        </x:state>      

        <x:final id="exit">
        </x:final>

        <x:final id="cancel">
        </x:final>

        <x:final id="success">
        </x:final>

    </x:scxml>    

</f:metadata>
